{% extends 'pool_service/base.html' %}

{% block title %}&#1054;&#1087;&#1083;&#1072;&#1090;&#1072;{% endblock %}

{% block content %}
<div class="card card-soft p-4">
  <h3 class="fw-bold h5 mb-2">&#1054;&#1087;&#1083;&#1072;&#1090;&#1072; &#1080; &#1087;&#1088;&#1086;&#1076;&#1083;&#1077;&#1085;&#1080;&#1077;</h3>
  <p class="text-muted mb-3">
    &#1057;&#1077;&#1081;&#1095;&#1072;&#1089; &#1087;&#1083;&#1072;&#1090;&#1077;&#1078;&#1085;&#1072;&#1103; &#1095;&#1072;&#1089;&#1090;&#1100; &#1074; &#1088;&#1072;&#1079;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1077;.
    &#1063;&#1090;&#1086;&#1073;&#1099; &#1087;&#1088;&#1086;&#1076;&#1083;&#1080;&#1090;&#1100; &#1076;&#1086;&#1089;&#1090;&#1091;&#1087;, &#1089;&#1074;&#1103;&#1078;&#1080;&#1090;&#1077;&#1089;&#1100; &#1089; &#1085;&#1072;&#1084;&#1080;:
  </p>
  <div class="d-flex flex-column gap-2">
    <div class="fw-semibold">Email: <a href="mailto:support@rovikpool.ru">support@rovikpool.ru</a></div>
    <div class="fw-semibold">Telegram: <a href="https://t.me/rovikpool" target="_blank" rel="noopener">t.me/rovikpool</a></div>
  </div>
</div>
{% if can_request_payment and payment_org %}
  <div class="card card-soft p-4 mt-4">
    <h4 class="fw-bold mb-3">&#1047;&#1072;&#1087;&#1088;&#1086;&#1089; &#1087;&#1088;&#1086;&#1076;&#1083;&#1077;&#1085;&#1080;&#1103;</h4>
    <form method="post" action="{% url 'billing_request' %}">
      {% csrf_token %}
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label">&#1057;&#1088;&#1086;&#1082; &#1087;&#1088;&#1086;&#1076;&#1083;&#1077;&#1085;&#1080;&#1103;</label>
          <select name="months" class="form-select">
            <option value="1">1 &#1084;&#1077;&#1089;</option>
            <option value="3">3 &#1084;&#1077;&#1089;</option>
            <option value="6">6 &#1084;&#1077;&#1089;</option>
            <option value="12">12 &#1084;&#1077;&#1089;</option>
          </select>
        </div>
        <div class="col-md-5">
          <label class="form-label">&#1050;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1072;&#1088;&#1080;&#1081;</label>
          <input type="text" name="note" class="form-control" placeholder="&#1044;&#1072;&#1085;&#1085;&#1099;&#1077; &#1086;&#1073; &#1086;&#1087;&#1083;&#1072;&#1090;&#1077;">
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary w-100">&#1054;&#1090;&#1087;&#1088;&#1072;&#1074;&#1080;&#1090;&#1100; &#1079;&#1072;&#1103;&#1074;&#1082;&#1091;</button>
        </div>
      </div>
    </form>
  </div>

  <div class="card card-soft p-4 mt-4">
    <h4 class="fw-bold mb-3">&#1048;&#1089;&#1090;&#1086;&#1088;&#1080;&#1103; &#1087;&#1088;&#1086;&#1076;&#1083;&#1077;&#1085;&#1080;&#1081;</h4>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead class="small text-muted">
          <tr>
            <th>&#1044;&#1072;&#1090;&#1072;</th>
            <th>&#1055;&#1077;&#1088;&#1080;&#1086;&#1076;</th>
            <th>&#1057;&#1090;&#1072;&#1090;&#1091;&#1089;</th>
            <th>&#1056;&#1077;&#1096;&#1077;&#1085;&#1080;&#1077;</th>
          </tr>
        </thead>
        <tbody>
          {% for req in payment_requests %}
            <tr>
              <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
              <td>{{ req.months }} &#1084;&#1077;&#1089;</td>
              <td>
                {% if req.status == "pending" %}
                  <span class="badge bg-warning-subtle text-warning border">&#1054;&#1078;&#1080;&#1076;&#1072;&#1077;&#1090;</span>
                {% elif req.status == "approved" %}
                  <span class="badge bg-success-subtle text-success border">&#1054;&#1076;&#1086;&#1073;&#1088;&#1077;&#1085;&#1086;</span>
                {% elif req.status == "rejected" %}
                  <span class="badge bg-danger-subtle text-danger border">&#1054;&#1090;&#1082;&#1083;&#1086;&#1085;&#1077;&#1085;&#1086;</span>
                {% else %}
                  <span class="badge bg-secondary-subtle text-secondary border">{{ req.status }}</span>
                {% endif %}
              </td>
              <td>
                {% if req.status == "approved" and req.paid_until_after %}
                  &#1055;&#1088;&#1086;&#1076;&#1083;&#1077;&#1085;&#1086; &#1076;&#1086; {{ req.paid_until_after|date:"d.m.Y" }}
                {% elif req.status == "rejected" %}
                  &#1054;&#1090;&#1082;&#1083;&#1086;&#1085;&#1077;&#1085;&#1086;
                {% else %}
                  &#8212;
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="4" class="text-center text-muted py-3">&#1053;&#1077;&#1090; &#1080;&#1089;&#1090;&#1086;&#1088;&#1080;&#1080;</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}
{% endblock %}
