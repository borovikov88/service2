{% extends 'pool_service/base.html' %}

{% block title %}&#1050;&#1083;&#1080;&#1077;&#1085;&#1090;&#1099;{% endblock %}

{% block content %}
<div class="card card-soft p-4">
  <h4 class="fw-bold mb-3">&#1050;&#1083;&#1080;&#1077;&#1085;&#1090;&#1099; &#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1085;&#1086;&#1081; &#1082;&#1086;&#1084;&#1087;&#1072;&#1085;&#1080;&#1080;</h4>
  <div class="table-responsive">
    <table class="table align-middle">
      <thead class="small text-muted">
        <tr>
          <th>&#1050;&#1083;&#1080;&#1077;&#1085;&#1090;</th>
          <th>&#1058;&#1080;&#1087;</th>
          <th>&#1058;&#1077;&#1083;&#1077;&#1092;&#1086;&#1085;</th>
          <th>Email</th>
          <th>&#1041;&#1072;&#1089;&#1089;&#1077;&#1081;&#1085;&#1086;&#1074;</th>
          {% if user.is_superuser %}<th>&#1054;&#1088;&#1075;&#1072;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;</th>{% endif %}
          {% if not user.is_superuser %}<th class="text-end"></th>{% endif %}
        </tr>
      </thead>
      <tbody>
        {% for client in clients %}
          <tr>
            <td class="fw-semibold">{{ client.name }}</td>
            <td>
              {% if client.client_type == "legal" %}
                &#1070;&#1088;. &#1083;&#1080;&#1094;&#1086;
              {% else %}
                &#1063;&#1072;&#1089;&#1090;&#1085;&#1099;&#1081;
              {% endif %}
            </td>
            <td>{{ client.phone|default:"-" }}</td>
            <td>{{ client.email|default:"-" }}</td>
            <td>{{ client.pool_count|default:0 }}</td>
            {% if user.is_superuser %}
              <td>{{ client.organization.name|default:"-" }}</td>
            {% endif %}
            {% if not user.is_superuser %}
              <td class="text-end">
                <div class="d-inline-flex gap-1">
                  <a class="btn btn-outline-secondary btn-sm {% if access_blocked %}opacity-50{% endif %}" {% if access_blocked %}data-requires-access="true"{% endif %} href="{% url 'client_edit' client.id %}" aria-label="&#1056;&#1077;&#1076;&#1072;&#1082;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;">
                    <i class="bi bi-pencil"></i>
                  </a>
                  {% if client.pool_count|default:0 > 0 %}
                    <button type="button" class="btn btn-outline-danger btn-sm opacity-50" data-client-delete-blocked="true" aria-label="&#1059;&#1076;&#1072;&#1083;&#1080;&#1090;&#1100;" title="&#1059; &#1082;&#1083;&#1080;&#1077;&#1085;&#1090;&#1072; &#1077;&#1089;&#1090;&#1100; &#1073;&#1072;&#1089;&#1089;&#1077;&#1081;&#1085;&#1099;">
                      <i class="bi bi-trash"></i>
                    </button>
                  {% else %}
                    <form method="post" action="{% url 'client_delete' client.id %}" class="d-inline">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-outline-danger btn-sm {% if access_blocked %}opacity-50{% endif %}" {% if access_blocked %}data-requires-access="true"{% endif %} aria-label="&#1059;&#1076;&#1072;&#1083;&#1080;&#1090;&#1100;" onclick="return confirm('&#1059;&#1076;&#1072;&#1083;&#1080;&#1090;&#1100; &#1082;&#1083;&#1080;&#1077;&#1085;&#1090;&#1072;?');">
                        <i class="bi bi-trash"></i>
                      </button>
                    </form>
                  {% endif %}
                </div>
              </td>
            {% endif %}
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-3">&#1055;&#1086;&#1082;&#1072; &#1085;&#1077;&#1090; &#1082;&#1083;&#1080;&#1077;&#1085;&#1090;&#1086;&#1074;</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div class="modal fade" id="clientDeleteBlockedModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">&#1059;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1077; &#1085;&#1077;&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1085;&#1086;</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        &#1047;&#1072; &#1101;&#1090;&#1080;&#1084; &#1082;&#1083;&#1080;&#1077;&#1085;&#1090;&#1086;&#1084; &#1079;&#1072;&#1082;&#1088;&#1077;&#1087;&#1083;&#1077;&#1085;&#1099; &#1073;&#1072;&#1089;&#1089;&#1077;&#1081;&#1085;&#1099;. &#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1087;&#1077;&#1088;&#1077;&#1085;&#1077;&#1089;&#1080;&#1090;&#1077; &#1080;&#1083;&#1080; &#1091;&#1076;&#1072;&#1083;&#1080;&#1090;&#1077; &#1080;&#1093;.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">&#1055;&#1086;&#1085;&#1103;&#1090;&#1085;&#1086;</button>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const modalEl = document.getElementById("clientDeleteBlockedModal");
    if (!modalEl) return;
    const modal = new bootstrap.Modal(modalEl);
    document.querySelectorAll("[data-client-delete-blocked]").forEach((btn) => {
      btn.addEventListener("click", (event) => {
        event.preventDefault();
        modal.show();
      });
    });
  });
</script>
{% endblock %}
