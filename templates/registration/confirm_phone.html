{% extends 'pool_service/base.html' %}
{% load static %}
{% block title %}&#1055;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1078;&#1076;&#1077;&#1085;&#1080;&#1077; &#1090;&#1077;&#1083;&#1077;&#1092;&#1086;&#1085;&#1072;{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
        <div class="card card-soft p-4">
            <div class="text-center mb-3">
                <img src="{% static brand_logo %}" alt="{{ brand_name }}" class="app-logo app-logo--compact mb-2">
                <h2 class="fw-bold h4 mb-1">&#1055;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1078;&#1076;&#1077;&#1085;&#1080;&#1077; &#1090;&#1077;&#1083;&#1077;&#1092;&#1086;&#1085;&#1072;</h2>
                <p class="text-muted mb-0">&#1055;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1076;&#1080;&#1090;&#1077; &#1085;&#1086;&#1084;&#1077;&#1088;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1080;&#1090;&#1100; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1072;&#1094;&#1080;&#1102;.</p>
            </div>

            {% if error_message %}
                <div class="alert alert-danger">{{ error_message }}</div>
            {% endif %}

            {% if phone_confirmed %}
                <div class="alert alert-success">&#1058;&#1077;&#1083;&#1077;&#1092;&#1086;&#1085; &#1087;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1078;&#1076;&#1077;&#1085;. &#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1087;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1076;&#1080;&#1090;&#1077; email &#1080; &#1074;&#1086;&#1081;&#1076;&#1080;&#1090;&#1077; &#1074; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1091;.</div>
                <a href="{% url 'login' %}" class="btn btn-primary w-100">&#1055;&#1077;&#1088;&#1077;&#1081;&#1090;&#1080; &#1082;&#1086; &#1074;&#1093;&#1086;&#1076;&#1091;</a>
            {% else %}
                {% if remaining_attempts == 0 %}
                    <div class="alert alert-warning">&#1051;&#1080;&#1084;&#1080;&#1090; &#1087;&#1086;&#1087;&#1099;&#1090;&#1086;&#1082; &#1080;&#1089;&#1095;&#1077;&#1088;&#1087;&#1072;&#1085;. &#1057;&#1074;&#1103;&#1078;&#1080;&#1090;&#1077;&#1089;&#1100; &#1089; &#1087;&#1086;&#1076;&#1076;&#1077;&#1088;&#1078;&#1082;&#1086;&#1081;.</div>
                {% endif %}
                <div class="mb-3">
                    <div class="text-muted small mb-1">&#1055;&#1086;&#1079;&#1074;&#1086;&#1085;&#1080;&#1090;&#1077; &#1089;&#1086; &#1089;&#1074;&#1086;&#1077;&#1075;&#1086; &#1085;&#1086;&#1084;&#1077;&#1088;&#1072; &#1085;&#1072;:</div>
                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                        {% if call_phone_display %}
                            <div class="fs-4 fw-bold">{{ call_phone_display }}</div>
                            {% if call_phone %}
                                <a class="btn btn-outline-primary btn-sm" href="tel:{{ call_phone }}">&#1055;&#1086;&#1079;&#1074;&#1086;&#1085;&#1080;&#1090;&#1100;</a>
                            {% endif %}
                        {% else %}
                            <div class="text-muted small">&#1053;&#1086;&#1084;&#1077;&#1088; &#1076;&#1083;&#1103; &#1079;&#1074;&#1086;&#1085;&#1082;&#1072; &#1087;&#1086;&#1082;&#1072; &#1085;&#1077; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;. &#1053;&#1072;&#1078;&#1084;&#1080;&#1090;&#1077; &#171;&#1047;&#1072;&#1087;&#1088;&#1086;&#1089;&#1080;&#1090;&#1100; &#1079;&#1074;&#1086;&#1085;&#1086;&#1082; &#1089;&#1085;&#1086;&#1074;&#1072;&#187; &#1080;&#1083;&#1080; &#1087;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1076;&#1080;&#1090;&#1077; &#1087;&#1086; &#1057;&#1052;&#1057;.</div>
                        {% endif %}
                    </div>
                    <div class="text-muted small mt-2">&#1055;&#1086;&#1087;&#1099;&#1090;&#1082;&#1072; &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090; 5 &#1084;&#1080;&#1085;&#1091;&#1090;. &#1054;&#1089;&#1090;&#1072;&#1083;&#1086;&#1089;&#1100; &#1087;&#1086;&#1087;&#1099;&#1090;&#1086;&#1082;: {{ remaining_attempts }}</div>
                </div>

                <div class="d-flex flex-wrap gap-2 mb-3">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="check_call">
                        <button class="btn btn-primary" type="submit">&#1055;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100; &#1079;&#1074;&#1086;&#1085;&#1086;&#1082;</button>
                    </form>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="start_call">
                        <button class="btn btn-outline-primary" type="submit" {% if remaining_attempts == 0 %}disabled{% endif %}>
                            &#1047;&#1072;&#1087;&#1088;&#1086;&#1089;&#1080;&#1090;&#1100; &#1079;&#1074;&#1086;&#1085;&#1086;&#1082; &#1089;&#1085;&#1086;&#1074;&#1072;
                        </button>
                    </form>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="send_sms">
                        <button class="btn btn-outline-secondary" type="submit" {% if remaining_attempts == 0 %}disabled{% endif %}>
                            &#1055;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1076;&#1080;&#1090;&#1100; &#1087;&#1086; &#1057;&#1052;&#1057;
                        </button>
                    </form>
                </div>

                {% if sms_sent %}
                    <form method="post" class="mt-3">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="verify_sms">
                        <div class="mb-2">
                            <label class="form-label">&#1050;&#1086;&#1076; &#1080;&#1079; &#1057;&#1052;&#1057;</label>
                            <input type="text" name="sms_code" class="form-control form-control-lg" inputmode="numeric" autocomplete="one-time-code" required>
                        </div>
                        <button class="btn btn-success w-100" type="submit">&#1055;&#1086;&#1076;&#1090;&#1074;&#1077;&#1088;&#1076;&#1080;&#1090;&#1100; &#1082;&#1086;&#1076;</button>
                    </form>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
